{% extends "base.html" %}

{% block content %}
<section class="tab-content space-y-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 minimal-card p-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                <div>
                    <h2 class="text-xl font-semibold text-slate-900">Attendance Overview</h2>
                    <p class="text-sm text-slate-500 mt-1">Visualizing your presence over the semester</p>
                </div>
                <div class="flex gap-2">
                    <a class="px-4 py-2 rounded-xl bg-slate-100 text-slate-700 text-sm font-medium hover:bg-slate-200 transition-all" href="{{ url_for('news') }}">News Feed</a>
                    <a class="px-4 py-2 rounded-xl minimal-btn minimal-btn-primary text-sm font-medium" href="{{ url_for('schedules') }}">Timetable</a>
                </div>
            </div>

            <div class="mt-6">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-xs font-medium text-slate-500">Attendance Heatmap</span>
                    <div class="flex items-center gap-2 text-xs text-slate-500">
                        <span>Less</span>
                        <div class="attendance-cell level-0"></div>
                        <div class="attendance-cell level-1"></div>
                        <div class="attendance-cell level-2"></div>
                        <div class="attendance-cell level-3"></div>
                        <div class="attendance-cell level-4"></div>
                        <span>More</span>
                    </div>
                </div>
                <div id="attendanceGrid" class="flex flex-wrap gap-[3px] p-4 bg-slate-50/50 rounded-xl border border-slate-100">
                </div>
                <script id="attendanceLevels" type="application/json">{{ (heatmap_levels or []) | tojson }}</script>
            </div>
        </div>

        <div class="p-4 rounded-xl bg-gradient-to-br from-indigo-600 to-purple-700 p-6 text-white">
            <div class="flex items-center justify-between mb-4">
                <span class="text-sm font-semibold">Immediate Attention</span>
                <span class="minimal-badge bg-white/20 text-white">{{ immediate_attention|length }} NEW</span>
            </div>
            <div class="space-y-4">
                {% if immediate_attention %}
                    {% for p in immediate_attention %}
                        <div class="p-3 bg-white/10 rounded-xl">
                            <div class="flex gap-3">
                                <div class="shrink-0 w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center text-lg">üö®</div>
                                <div class="min-w-0 flex-1">
                                    <div class="flex items-start justify-between gap-3">
                                        <p class="text-sm font-semibold leading-snug break-words">{{ p.heading }}</p>
                                        <span class="shrink-0 text-[10px] text-white/70">{{ p.date_time|fmt_dt }}</span>
                                    </div>
                                    <p class="text-xs text-white/80 mt-1 leading-relaxed overflow-hidden" style="display:-webkit-box;line-clamp:2;-webkit-line-clamp:2;-webkit-box-orient:vertical;">{{ p.body }}</p>
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        <span class="minimal-badge bg-white/20 text-white">{{ p.priority }}</span>
                                        <span class="minimal-badge bg-white/20 text-white">{{ p.news_type }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="p-4 bg-white/10 rounded-xl">
                        <p class="text-sm text-white/80">No urgent updates right now.</p>
                    </div>
                {% endif %}
            </div>
            <a class="mt-6 block w-full py-3 rounded-xl bg-white text-indigo-700 text-sm font-medium hover:bg-slate-100 transition-all text-center" href="{{ url_for('news') }}">View All Notifications</a>
        </div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <a class="minimal-card p-5 text-center hover:shadow-md transition-all cursor-pointer group" href="{{ url_for('news') }}">
            <div class="text-2xl mb-3 group-hover:scale-110 transition-transform">üì¢</div>
            <p class="text-sm font-medium text-slate-700">Notifications</p>
            <p class="text-xs text-slate-400 mt-1">Latest updates</p>
        </a>
        <a class="minimal-card p-5 text-center hover:shadow-md transition-all cursor-pointer group" href="{{ url_for('schedules') }}">
            <div class="text-2xl mb-3 group-hover:scale-110 transition-transform">üìÖ</div>
            <p class="text-sm font-medium text-slate-700">Calendar</p>
            <p class="text-xs text-slate-400 mt-1">Timetable</p>
        </a>
        <a class="minimal-card p-5 text-center hover:shadow-md transition-all cursor-pointer group" href="{{ url_for('news', tag='Assignments') }}">
            <div class="text-2xl mb-3 group-hover:scale-110 transition-transform">üìù</div>
            <p class="text-sm font-medium text-slate-700">Assignments</p>
            <p class="text-xs text-slate-400 mt-1">Pending tasks</p>
        </a>
        <a class="minimal-card p-5 text-center hover:shadow-md transition-all cursor-pointer group" href="{{ url_for('exams') }}">
            <div class="text-2xl mb-3 group-hover:scale-110 transition-transform">üèÜ</div>
            <p class="text-sm font-medium text-slate-700">Results</p>
            <p class="text-xs text-slate-400 mt-1">Performance</p>
        </a>
        <a class="minimal-card p-5 text-center hover:shadow-md transition-all cursor-pointer group" href="{{ url_for('library') }}">
            <div class="text-2xl mb-3 group-hover:scale-110 transition-transform">üìÇ</div>
            <p class="text-sm font-medium text-slate-700">Study Material</p>
            <p class="text-xs text-slate-400 mt-1">Resources</p>
        </a>
    </div>

    <div class="minimal-card p-6">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h3 class="text-lg font-semibold text-slate-900">Recent Announcements</h3>
                <p class="text-sm text-slate-500 mt-1">Official updates from faculty and admin</p>
            </div>
            <a class="text-sm font-medium text-indigo-600 hover:text-indigo-700" href="{{ url_for('news') }}">See All ‚Üí</a>
        </div>

        <div class="space-y-4">
            {% if announcements %}
                {% for p in announcements %}
                    {% set cat = 'GENERAL' %}
                    {% if p.priority in ['URGENT','HIGH'] %}
                        {% set cat = 'URGENT' %}
                    {% elif p.news_type == 'Event' %}
                        {% set cat = 'EVENT' %}
                    {% endif %}
                    {% set tag_list = (p.tags.split(',') if p.tags else []) %}
                    <div class="p-4 rounded-xl border {% if cat == 'URGENT' %}border-rose-200 bg-gradient-to-r from-rose-50 to-white{% elif cat == 'EVENT' %}border-amber-200 bg-gradient-to-r from-amber-50 to-white{% else %}border-slate-200 bg-white{% endif %} flex flex-col md:flex-row gap-4 items-start">
                        <div class="minimal-badge {% if cat == 'URGENT' %}bg-rose-100 text-rose-700{% elif cat == 'EVENT' %}bg-amber-100 text-amber-700{% else %}bg-slate-100 text-slate-700{% endif %} flex items-center gap-1.5">
                            {% if cat == 'URGENT' %}<span>üö®</span>{% elif cat == 'EVENT' %}<span>üéâ</span>{% else %}<span>‚ÑπÔ∏è</span>{% endif %} {{ cat }}
                        </div>
                        <div class="flex-1">
                            <div class="flex flex-col md:flex-row md:items-center justify-between gap-1 mb-2">
                                <h4 class="text-sm font-semibold text-slate-900">{{ p.heading }}</h4>
                                <span class="text-xs text-slate-400">{{ p.date_time|fmt_dt }}</span>
                            </div>
                            <p class="text-sm text-slate-600 leading-relaxed mb-3">{{ p.body }}</p>
                            <div class="flex flex-wrap items-center gap-3 text-xs text-slate-500">
                                <span class="flex items-center gap-1">üë§ {{ p.sender }}</span>
                                <span class="w-1 h-1 rounded-full bg-slate-300"></span>
                                <span class="minimal-badge bg-indigo-50 text-indigo-700">{{ p.news_type }}</span>
                                <span class="minimal-badge bg-slate-100 text-slate-600">{{ p.priority }}</span>
                                {% if tag_list and tag_list[0].strip() %}
                                    <span class="minimal-badge bg-indigo-50 text-indigo-700">#{{ tag_list[0].strip() }}</span>
                                {% endif %}
                                {% if (tag_list|length) > 1 and tag_list[1].strip() %}
                                    <span class="minimal-badge bg-slate-100 text-slate-600">#{{ tag_list[1].strip() }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="p-6 rounded-xl border border-slate-200 bg-white text-sm text-slate-500">No announcements yet.</div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
